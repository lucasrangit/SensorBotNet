{% extends "base.html" %}
{% block title %}#{{ device.key().name() }}{% endblock %}
{% block head %}
    <link href="/static/bootstrap/css/cover.css" rel="stylesheet" type="text/css" />
{% endblock %}
{% block content %}

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand">StatusBot.net</h3>
              <ul class="nav masthead-nav">
                <li class="active"><a href="#">Device #{{ device.key().name() }}</a></li>
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">About</a></li>
              </ul>
            </div>
          </div>

          <div class="inner cover">
            <h1 class="cover-heading">
              StatusBot #{{ device.key().name() }}
            </h1>
            <p class="lead">
            {% if current_state == 'ready' %}
              Ready!
            {% else %}
              {{ current_state }}</br>
              {% if status_last_ready %}
                Last Ready {{ status_last_ready.created.strftime('%H:%M:%S') }}
              {% endif %}
            {% endif %}
            </p>
            <p class="lead">
              <a href="#" id="subscribe-button" class="btn btn-lg btn-default" data-toggle="collapse" data-target="#subscribe-area">Get one-time ready notification</a>
            </p>
  {% if device %}
  <div class="collapse-group">
  <div id="subscribe-area" class="collapse">
    <p>Subscribers: {{ subscriber_list.count(20) }}</p>
    <form id="form-subscribe" action="/subscribe" method="post">
      <div class="form-group">
        <input name="device_id" id="device_id" type="hidden" size="1" value="{{ device.key().name() }}" class="form-control" />
      </div>
      <div class="form-group">
        <label for="email" class="control-label" >Email</label>
        <input name="email" id="email" type="text" class="form-control" />
      </div>
      <input type="submit" class="btn" value="Subscribe" />
    </form>
  </div>
  </div>
  {% endif %}

          </div>

          <div class="mastfoot">
            <div class="inner">
              <p>Cover template for <a href="http://getbootstrap.com">Bootstrap</a>, by <a href="https://twitter.com/mdo">@mdo</a>.</p>
            </div>
          </div>

        </div>

      </div>

    </div>
<!--
  <p>Server time: {{ datetime.strftime('%H:%M:%S') }}</p>
  <table border="1" style="width:300px">
    <tr>
      <th>Time</th>
      <th>State</th>
      <th>Digital 1</th>
      <th>Digital 2</th>
      <th>Analog 1</th>
    </tr>
  {% for status in status_list %}
    <tr>
        <td>{{ status.created.strftime('%H:%M:%S') }}</td>
        <td>{{ status.state }}</td>
        <td>{{ status.digital1 }}</td>
        <td>{{ status.digital2 }}</td> 
        <td>{{ status.analog1 }}</td> 
    </tr>
  {% endfor %}
  </table>
-->
{% endblock %}

{% block scripts %}
<script>
// Attach a submit handler to the form
$( "#form-subscribe" ).submit(function( event ) {
  // Stop form from submitting normally
  event.preventDefault();

  // Get some values from elements on the page:
  var $form = $( this ),
    device_id = $form.find( "input[name='device_id']" ).val(),
    email = $form.find( "input[name='email']" ).val();
    url = $form.attr( "action" );

  // Send the data using post
  // FIXME try using serialize()
  var posting = $.post( url, { 'device_id': device_id, 'email': email } );

  // Put the results in a div
  posting.done(function( data ) {
    $( "#subscribe-button" ).empty().append( data );
    $( '.collapse' ).collapse('hide');
  });
});
</script>
{% endblock %}
